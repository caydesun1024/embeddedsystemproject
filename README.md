## π“ μ¤λ§νΈ λΈ”λΌμΈλ“ μ‹μ¤ν… ν…€ ν”„λ΅μ νΈ κ²°κ³Ό λ³΄κ³ μ„

**κ³Όλ©λ…:** μ„λ² λ””λ“ μ‹μ¤ν… μ„¤κ³„ λ° μ‹¤ν—
**λ‹΄λ‹Ήκµμ:** κΉ€μ›μ„
**μ μ¶μΌ:** 2024/12/23
**ν•™κ³Ό:** μ •λ³΄μ»΄ν“¨ν„°κ³µν•™λ¶€
**ν€μ¥:** κΉ€λ€μ±
**ν€μ›:** μ„¤μΆ…ν™, λ°•μ •λ―Ό, μ΄μΉμ›

---

### 1. ν”„λ΅μ νΈ κ°μ” (Overview)

λ³Έ ν”„λ΅μ νΈλ” μ¤λ§νΈ λΈ”λΌμΈλ“ μ‹μ¤ν…μ„ κ°λ°ν•μ—¬ ν„λ€ κ°€μ • λ° μ‚¬λ¬΄μ‹¤ ν™κ²½μ—μ„μ **νΈλ¦¬μ„±**, **μ—λ„μ§€ μ μ•½**, **μ‚¬μ©μ κ²½ν— κ°μ„ **μ„ λ©ν‘λ΅ ν•©λ‹λ‹¤. μ—¬λ¬ μ„Όμ„μ™€ λΈ”λ£¨ν¬μ¤ λ¨λ“μ„ ν™μ©ν•μ—¬ ν™κ²½ μ΅°κ±΄μ΄λ‚ μ‚¬μ©μμ μ›κ²© λ…λ Ήμ— λ”°λΌ λΈ”λΌμΈλ“λ¥Ό μλ™μΌλ΅ μ μ–΄ν•λ” μ„λ² λ””λ“ μ‹μ¤ν…μ„ κµ¬ν„ν–μµλ‹λ‹¤.

---

### 2. μ£Όμ” κ°λ° λ‚΄μ© λ° κΈ°μ  μ”μ•½ (Key Features and Technology Summary)

#### 2.1. κΈ°λ¥ κµ¬ν„
| κΈ°λ¥ | κµ¬ν„ λ°©μ‹ | μ„¤λ… |
|:---|:---|:---|
| **ν™κ²½ μ„Όμ„ κΈ°λ° μλ™ μ μ–΄** | ADC1 λ° λ‘ μ±„λ„(μ΅°λ„, μ¨λ„) κΈ°λ° λ°μ΄ν„° λ³€ν™ | **μ΅°λ„ μ„Όμ„ (GL5537)** μΈ΅μ •κ°’μ΄ μ„κ³„κ°’ (4000 lux)μ„ μ΄κ³Όν•  λ•λ§ **μ¨λ„ μ„Όμ„ (LM35DZ)**λ¥Ό ν™μ„±ν™”ν•μ—¬ μ—λ„μ§€ μ†λΉ„λ¥Ό μ κ°ν•©λ‹λ‹¤. μ¨λ„κ°€ μ„κ³„κ°’ (28λ„) μ΄μƒμ΄λ©΄ λΈ”λΌμΈλ“κ°€ μλ™μΌλ΅ λ‚΄λ ¤κ°‘λ‹λ‹¤. |
| **λΈ”λ£¨ν¬μ¤ λ° μ μ„  μλ™ μ μ–΄** | UART2/UART1 μΈν„°λ½νΈλ¥Ό ν™μ©ν• λ…λ Ή μμ‹  λ° μ²λ¦¬ | **λΈ”λ£¨ν¬μ¤ (UART2)** λ¨λ“μ„ ν†µν•΄ μ¤λ§νΈν° μ•±μΌλ΅ μ›κ²© μ μ–΄κ°€ κ°€λ¥ν•λ©°, **μ μ„  (UART1)** λ…λ Ήμ„ ν†µν•΄ PCμ—μ„λ„ μ μ–΄ν•  μ μμµλ‹λ‹¤. λ…λ Ήμ€ **'u'(μ¬λ¦¬κΈ°)**, **'d'(λ‚΄λ¦¬κΈ°)**, **'s'(μ •μ§€)**λ΅ κµ¬μ„±λ©λ‹λ‹¤. |
| **λ¨ν„° μ μ–΄ λ° μ•μ „ μ¥μΉ** | GPIO κΈ°λ° λ¨ν„° λ°©ν–¥ λ° μ†λ„ μ μ–΄ | λ¨ν„° 2κ°μ™€ L298N λ¨ν„° λ“λΌμ΄λΈλ¥Ό μ‚¬μ©ν•μ—¬ λΈ”λΌμΈλ“μ μƒν•λ¥Ό μ μ–΄ν•©λ‹λ‹¤. λΈ”λΌμΈλ“κ°€ μ΄λ―Έ μµμƒλ‹¨/μµν•λ‹¨μ— μλ” κ²½μ° μ¶”κ°€ λ…λ Ήμ€ λ¬΄μ‹λ©λ‹λ‹¤. |
| **λ…λ Ή μ²λ¦¬ μ•μ •ν™”** | κ³ μ • ν¬κΈ°μ **λ…λ Ή ν (command Queue)** κµ¬ν„ | UART ν†µμ‹  κ³Όμ •μ—μ„ λ°μ΄ν„° μμ‹  μ†λ„μ™€ μ²λ¦¬ μ†λ„μ λ¶μΌμΉλ΅ λ…λ Ήμ΄ λ¬΄μ‹λλ” ν„μƒμ„ ν•΄κ²°ν•κΈ° μ„ν•΄ λ…λ Ήμ„ Queueingν•μ—¬ μ•μ •μ μΌλ΅ μ²λ¦¬ν•©λ‹λ‹¤. |
| **LCD λ””μ¤ν”λ μ΄ μ •λ³΄ μ κ³µ** | LCD\_ShowString ν•¨μλ΅ μƒνƒμ™€ λ°μ΄ν„°λ¥Ό μ‹¤μ‹κ°„ ν‘μ‹ | λΈ”λΌμΈλ“ μƒνƒ ("blind up", "blind down", "stopped"), ν„μ¬ μ΅°λ„/μ¨λ„ λ°μ΄ν„°, κ·Έλ¦¬κ³  μ—λ¬ λ©”μ‹μ§€ ("Full Queue", "Already Up", "Already Down")λ¥Ό μ‹¤μ‹κ°„μΌλ΅ ν‘μ‹ν•©λ‹λ‹¤. |

#### 2.2. ν•λ“μ›¨μ–΄ μ„¤μ • (Configuration Summary)
| μ„¤μ • ν•­λ© | μ£Όμ” λ‚΄μ© |
|:---|:---|
| **ν΄λ­ (RCC)** | GPIO A, B, C, D ν¬νΈ, USART1/2, AFIO, ADC1 ν΄λ­ ν™μ„±ν™”. |
| **GPIO** | UART1 (PA9, PA10), UART2 (PA2, PA3), λ¨ν„° 1 (PB1, PB2), λ¨ν„° 2 (PD1, PD2), μ„Όμ„ (μ΅°λ„: PC2, μ¨λ„: PC1) ν•€ μ„¤μ •. |
| **ADC** | ADC1μ„ λ…λ¦½ λ¨λ“, λ‹¨μΌ μ±„λ„ λ¨λ“λ΅ μ„¤μ •. EOC μΈν„°λ½νΈ ν™μ„±ν™”. μ΄κΈ° μ±„λ„μ€ μ΅°λ„ μ„Όμ„ (ADC\_Channel\_12). |
| **USART** | USART1, USART2 λ¨λ‘ 9600 BaudRate, 8λΉ„νΈ, ν¨λ¦¬ν‹° μ—†μ, 1 Stop Bitλ΅ μ„¤μ •. RXNE μΈν„°λ½νΈ ν™μ„±ν™”. |
| **NVIC** | USART μΈν„°λ½νΈ (**λ†’μ€ μ°μ„ μμ„**)λ¥Ό ADC μΈν„°λ½νΈ (**λ‚®μ€ μ°μ„ μμ„**)λ³΄λ‹¤ λ†’κ² μ„¤μ •ν•μ—¬ μ‹¤μ‹κ°„ ν†µμ‹  λ³΄μ¥. |

---

### 3. μ£Όμ” μ•κ³ λ¦¬μ¦ λ° μ‹μ¤ν… λ™μ‘

#### 3.1. λ…λ Ή ν λ° UART μΈν„°λ½νΈ
* `enqueueCommand()`: μ™Έλ¶€μ—μ„ μμ‹ λ λ…λ Ήμ„ νμ— μ €μ¥ν•©λ‹λ‹¤. νκ°€ κ°€λ“ μ°¬ κ²½μ° `stateString`μ„ "**Full Queue**"λ΅ μ„¤μ •ν•©λ‹λ‹¤.
* `USART1_IRQHandler()` / `USART2_IRQHandler()`: UARTλ΅ λ…λ Ή μμ‹  μ‹ ν”λκ·Έ(`flagUART1` λλ” `flagUART2`)λ¥Ό μ„¤μ •ν•κ³ , μμ‹ λ λ…λ Ήμ„ **λ…λ Ή ν**μ— μ €μ¥ν•©λ‹λ‹¤.
* **ν†µμ‹  νλ¦„:**
    * **PC/μ¤λ§νΈν° β†’ USART1/2 IRQ β†’ ν μ €μ¥**
    * **λ©”μΈ λ£¨ν”„:** `flagUART`λ¥Ό ν™•μΈν•μ—¬ νμ—μ„ λ…λ Ήμ„ κΊΌλ‚΄(`dequeueCommand()`) μ²λ¦¬ν•©λ‹λ‹¤.
        * **USART1 μ²λ¦¬:** μμ‹ ν• λ…λ Ήμ„ USART2λ΅ μ „λ‹¬ (λΈ”λ£¨ν¬μ¤ μ¥μΉλ΅ μ „μ†΅).
        * **USART2 μ²λ¦¬:** μμ‹ ν• λ…λ Ήμ„ USART1λ΅ μ „λ‹¬ (PCλ΅ μ „μ†΅)ν•κ³  **Motor\_Control**μ„ μν–‰ν•©λ‹λ‹¤.

#### 3.2. ADC μ„Όμ„ μ μ–΄ λ° μΈν„°λ½νΈ (`ADC1_2_IRQHandler`)
1.  **μ΅°λ„ μΈ΅μ •:** μ΄κΈ° μƒνƒμ—μ„λ” μ΅°λ„ μ„Όμ„ (μ±„λ„ 12) κ°’μ„ μ½μµλ‹λ‹¤.
2.  **μ¨λ„ μ„Όμ„ ν™μ„±ν™”:** μ΅°λ„ κ°’μ΄ **4000 lux**λ¥Ό μ΄κ³Όν•λ©΄ `tempSensorActive`λ¥Ό `true`λ΅ μ„¤μ •ν•κ³  μ±„λ„μ„ **μ¨λ„ μ„Όμ„ (μ±„λ„ 11)**λ΅ μ „ν™ν•©λ‹λ‹¤.
3.  **μ¨λ„ μΈ΅μ • λ° μλ™ μ μ–΄:** μ¨λ„ μ„Όμ„ κ°’μΌλ΅ κ³„μ‚°ν• μ¨λ„κ°€ **$28^\circ \text{C}$** μ΄μƒμ΄λ©΄ `Blind_Down()` ν•¨μλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
4.  **μ΅°λ„ μ„Όμ„λ΅ λ³µκ·€:** μλ™ μ μ–΄ μ™„λ£ ν›„ `tempSensorActive`λ¥Ό `false`λ΅ μ„¤μ •ν•κ³  μ±„λ„μ„ λ‹¤μ‹ μ΅°λ„ μ„Όμ„λ΅ μ „ν™ν•©λ‹λ‹¤.
    * **μ±„λ„ μ „ν™ μ‹ μ²λ¦¬:** μ±„λ„ μ „ν™ ν›„ μ²« λ²μ§Έ λ³€ν™ κ°’μ€ λ¶€μ •ν™•ν•λ―€λ΅ λ¬΄μ‹ν•λ©°, λ§¤ μ±„λ„ μ „ν™ μ‹ ADC λ³΄μ •(Calibration)μ„ μν–‰ν•©λ‹λ‹¤.

#### 3.3. λ¨ν„° μ μ–΄ (`Blind_Up`, `Blind_Down`)
* **μƒνƒ ν™•μΈ:** λΈ”λΌμΈλ“μ ν„μ¬ μ„μΉλ¥Ό `blindPosition` (FSM κµ¬μ΅°)μ„ ν†µν•΄ ν™•μΈν•©λ‹λ‹¤. μ΄λ―Έ μµμƒλ‹¨/μµν•λ‹¨μΌ κ²½μ° LCDμ— "**Already Up**" λλ” "**Already Down**" λ©”μ‹μ§€λ¥Ό ν‘μ‹ν•κ³  λ™μ‘μ„ λ¬΄μ‹ν•©λ‹λ‹¤.
* **λ¨ν„° κµ¬λ™:** `BLIND_POSITION_MOVING` μƒνƒλ΅ μ„¤μ •ν• ν›„, λ¨ν„° 1 (PB1, PB2)κ³Ό λ¨ν„° 2 (PD1, PD2)μ GPIO λΉ„νΈ μ„¤μ •μ„ ν†µν•΄ μ •λ°©ν–¥/μ—­λ°©ν–¥μΌλ΅ νμ „μ‹ν‚µλ‹λ‹¤.
* **μ‹κ°„ μ μ–΄:** μ„¤μ •λ λ”λ μ΄(`BLIND_UP_PERIOD`/`BLIND_DOWN_PERIOD`) λ™μ•λ§ μ‘λ™ ν›„ `Blind_Stop()`μ„ νΈμ¶ν•μ—¬ μ •μ§€ν•©λ‹λ‹¤.

---

### 4. κΈ°μ΅΄ κ³„νκ³Ό λ‹¬λΌμ§„ κ°λ° λ‚΄μ©

| ν•­λ© | κΈ°μ΅΄ κ³„ν | μ‹¤μ  κµ¬ν„ | μ΄μ  λ° κ²°κ³Ό |
|:---|:---|:---|:---|
| **λ¨ν„° μ†λ„ μ μ–΄** | L298N λ“λΌμ΄λ²„μ EN1, EN2 ν•€μ„ ν†µν• **PWM μ μ–΄**λ΅ λΈ”λΌμΈλ“ λ™μ‘μ„ μμ—°μ¤λ½κ² κµ¬ν„. | PB1, PB2, PD1, PD2 ν•€μ„ μ΄μ©ν• **GPIO μ μ–΄**λ΅ ν•­μƒ **μµλ€ μ†λ„**λ΅ νμ „ν•λ„λ΅ κµ¬ν„. | κΈ°νλ ν•€(PB3, PB4, PB5 λ“±)μ„ ν†µν• PWM μ μ–΄κ°€ μ‘λ™ν•μ§€ μ•μ•μµλ‹λ‹¤. μ‹ν„ μΌμ •μ„ κ³ λ ¤ν•μ—¬ PWM μ μ–΄λ¥Ό ν¬κΈ°ν•κ³  μµλ€ μ†λ„λ΅ κµ¬ν„ν•κ² λμ—μµλ‹λ‹¤. |
